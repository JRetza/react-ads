(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{165:function(e,n,r){"use strict";r.r(n),r.d(n,"currencySupportEnabled",(function(){return b})),r.d(n,"currencyRates",(function(){return h})),r.d(n,"setConfig",(function(){return S})),r.d(n,"addBidResponseHook",(function(){return D}));var o=r(34),c=r(9),t=r(22),i=r(0),s=r(2),a=r(7);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f,d="https://cdn.jsdelivr.net/gh/prebid/currency-file@1/latest.json?date=$$TODAY$$",l=[],y={},g=!1,v=!0,p="USD",b=!1,h={},C={};function S(e){var n=d;if("object"===u(e.rates)&&(h.conversions=e.rates,g=!0,v=!1),"object"===u(e.defaultRates)&&(f=e.defaultRates,h.conversions=f,g=!0),"string"==typeof e.adServerCurrency){i.logInfo("enabling currency support",arguments),p=e.adServerCurrency,e.conversionRateFile&&(i.logInfo("currency using override conversionRateFile:",e.conversionRateFile),n=e.conversionRateFile);var r=n.indexOf("$$TODAY$$");if(-1!==r){var o=new Date,c="".concat(o.getMonth()+1),t="".concat(o.getDate());c.length<2&&(c="0".concat(c)),t.length<2&&(t="0".concat(t));var s="".concat(o.getFullYear()).concat(c).concat(t);n="".concat(n.substring(0,r)).concat(s).concat(n.substring(r+9,n.length))}w(n)}else i.logInfo("disabling currency support"),R();"object"===u(e.bidderCurrencyDefault)&&(C=e.bidderCurrencyDefault)}function m(e){f?(i.logWarn(e),i.logWarn("Currency failed loading rates, falling back to currency.defaultRates")):i.logError(e)}function w(e){y={},b=!0,i.logInfo("Installing addBidResponse decorator for currency module",arguments),Object(a.a)("addBidResponse").before(D,100),v&&(v=!1,Object(t.a)(e,{success:function(e){try{h=JSON.parse(e),i.logInfo("currencyRates set to "+JSON.stringify(h)),g=!0,I()}catch(n){m("Failed to parse currencyRates response: "+e)}},error:m}))}function R(){i.logInfo("Uninstalling addBidResponse decorator for currency module",arguments),Object(a.a)("addBidResponse").getHooks({hook:D}).remove(),p="USD",y={},b=!1,g=!1,v=!0,h={},C={}}function D(e,n,r){if(!r)return e.call(this,n);var t=r.bidderCode||r.bidder;if(C[t]){var s=C[t];r.currency&&s!==r.currency?i.logWarn("Currency default '".concat(t,": ").concat(s,"' ignored. adapter specified '").concat(r.currency,"'")):r.currency=s}if(r.currency||(i.logWarn('Currency not specified on bid.  Defaulted to "USD"'),r.currency="USD"),r.getCpmInNewCurrency=function(e){return(parseFloat(this.cpm)*O(this.currency,e)).toFixed(3)},r.currency===p)return e.call(this,n,r);l.push(function(e,n,r){return function(){var t=r[1];if(void 0!==t&&"currency"in t&&"cpm"in t){var s=t.currency;try{var a=O(s);1!==a&&(t.cpm=(parseFloat(t.cpm)*a).toFixed(4),t.currency=p)}catch(e){i.logWarn("Returning NO_BID, getCurrencyConversion threw error: ",e),r[1]=Object(o.a)(c.STATUS.NO_BID,{bidder:t.bidderCode||t.bidder,bidId:t.requestId})}}return e.apply(n,r)}}(e,this,[n,r])),b&&!g||I()}function I(){for(;l.length>0;)l.shift()()}function O(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,o=null,c="".concat(e,"->").concat(r);if(c in y)o=y[c],i.logMessage("Using conversionCache value "+o+" for "+c);else if(!1===b){if("USD"!==e)throw new Error("Prebid currency support has not been enabled and fromCurrency is not USD");o=1}else if(e===r)o=1;else if(e in h.conversions){if(!(r in(n=h.conversions[e])))throw new Error("Specified adServerCurrency in config '"+r+"' not found in the currency rates file");o=n[r],i.logInfo("getCurrencyConversion using direct "+e+" to "+r+" conversionRate "+o)}else if(r in h.conversions){if(!(e in(n=h.conversions[r])))throw new Error("Specified fromCurrency '"+e+"' not found in the currency rates file");o=j(1/n[e],4),i.logInfo("getCurrencyConversion using reciprocal "+e+" to "+r+" conversionRate "+o)}else{var t=Object.keys(h.conversions)[0];if(!(e in h.conversions[t]))throw new Error("Specified fromCurrency '"+e+"' not found in the currency rates file");var s=1/h.conversions[t][e];if(!(r in h.conversions[t]))throw new Error("Specified adServerCurrency in config '"+r+"' not found in the currency rates file");var a=h.conversions[t][r];o=j(s*a,4),i.logInfo("getCurrencyConversion using intermediate "+e+" thru "+t+" to "+r+" conversionRate "+o)}return c in y||(i.logMessage("Adding conversionCache value "+o+" for "+c),y[c]=o),o}function j(e,n){for(var r=1,o=0;o<n;o++)r+="0";return Math.round(e*r)/r}s.b.getConfig("currency",(function(e){return S(e.currency)}))}}]);