(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{33:function(e,t,i){"use strict";i.r(t),i.d(t,"callPrebidCacheHook",(function(){return w})),i.d(t,"checkAdUnitSetupHook",(function(){return D})),i.d(t,"checkVideoBidSetupHook",(function(){return j})),i.d(t,"adpodSetConfig",(function(){return O})),i.d(t,"callPrebidCacheAfterAuction",(function(){return B})),i.d(t,"sortByPricePerSecond",(function(){return U})),i.d(t,"getTargeting",(function(){return k}));var n=i(277),a=i(300),r=i(357),o=i(316),d=i(291),c=i(355),u=i(280),s=i(279),f=i(341),l=i.n(f),g=i(286),p=i.n(g),b=i(294),v=i(282);function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],n=!0,a=!1,r=void 0;try{for(var o,d=e[Symbol.iterator]();!(n=(o=d.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(e){a=!0,r=e}finally{try{n||null==d.return||d.return()}finally{if(a)throw r}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var C=i(354),_=50,A=5,S=function(){var e={};function t(t){var i,a,r;e[t]={},e[t].bidStorage=new l.a,e[t].queueDispatcher=(i=_,r=1,function(e,t,n,o){var d=this,c=function(){I.call(d,e,t,n)};clearTimeout(a),o?r=1:r===A?(r=1,c()):(r++,a=setTimeout(c,i))}),e[t].initialCacheKey=n.generateUUID()}return{addBid:function(i){e[i.auctionId]||t(i.auctionId),e[i.auctionId].bidStorage.add(i)},removeBid:function(t){e[t.auctionId].bidStorage.delete(t)},getBids:function(t){return e[t.auctionId]&&e[t.auctionId].bidStorage.values()},getQueueDispatcher:function(t){return e[t.auctionId]&&e[t.auctionId].queueDispatcher},setupInitialCacheKey:function(t){e[t.auctionId]||(e[t.auctionId]={},e[t.auctionId].initialCacheKey=n.generateUUID())},getInitialCacheKey:function(t){return e[t.auctionId]&&e[t.auctionId].initialCacheKey}}}();function E(e,t){var i,r=S.getInitialCacheKey(e),o=n.deepAccess(e,"video.durationBucket"),d=function(e){var t;if(u.b.getConfig("adpod.prioritizeDeals")&&n.deepAccess(e,"video.dealTier")){var i=u.b.getConfig("adpod.dealTier.".concat(e.bidderCode,".prefix"));t=i?i+n.deepAccess(e,"video.dealTier"):n.deepAccess(e,"video.dealTier")}else{var r=Object(a.i)(e.mediaType);t=Object(a.h)(r)(e)}return t}(e);if(t){var c=n.deepAccess(e,"meta.adServerCatId");i="".concat(d,"_").concat(c,"_").concat(o,"s")}else i="".concat(d,"_").concat(o,"s");e.adserverTargeting||(e.adserverTargeting={}),e.adserverTargeting.hb_pb_cat_dur=i,e.adserverTargeting.hb_cache_id=r,e.videoCacheKey=r,e.customCacheKey="".concat(i,"_").concat(r)}function I(e,t,i){!function(e){for(var t=0;t<e.length;t++)S.removeBid(e[t])}(t),Object(c.b)(t,(function(r,o){if(r){n.logWarn("Failed to save to the video cache: ".concat(r,". Video bid(s) must be discarded."));for(var d=0;d<t.length;d++)Object(a.g)(e,t[d])}else for(var c=0;c<o.length;c++)""!==o[c].uuid?Object(a.d)(e,t[c]):n.logInfo("Detected a bid was not cached because the custom key was already registered.  Attempted to use key: ".concat(t[c].customCacheKey,". Bid was: "),t[c]),i()}))}function w(e,t,i,r,o){var d=n.deepAccess(o,"mediaTypes.video");if(d&&d.context===s.a){var c=u.b.getConfig("adpod.brandCategoryExclusion");!n.deepAccess(i,"meta.adServerCatId")&&c?(n.logWarn("Detected a bid without meta.adServerCatId while setConfig({adpod.brandCategoryExclusion}) was enabled.  This bid has been rejected:",i),r()):!1===u.b.getConfig("adpod.deferCaching")?(S.addBid(i),E(i,c),function(e,t,i){var r=S.getBids(t);if(r){var o=C(r),d=S.getQueueDispatcher(t),c=!(e.getAuctionStatus()===a.b);d(e,o,i,c)}else n.logWarn("Attempted to cache a bid from an unknown auction. Bid:",t)}(t,i,r)):(S.setupInitialCacheKey(i),E(i,c),Object(a.d)(t,i),r())}else e.call(this,t,i,r,o)}function D(e,t){var i=t.filter((function(e){var t=n.deepAccess(e,"mediaTypes"),i=n.deepAccess(t,"video");if(i&&i.context===s.a){if(Object.keys(t).length>1)return n.logWarn("Detected more than one mediaType in adUnitCode: ".concat(e.code," while attempting to define an 'adpod' video adUnit.  'adpod' adUnits cannot be mixed with other mediaTypes.  This adUnit will be removed from the auction.")),!1;var a="Detected missing or incorrectly setup fields for an adpod adUnit.  Please review the following fields of adUnitCode: ".concat(e.code,".  This adUnit will be removed from the auction."),r=!!(i.playerSize&&(n.isArrayOfNums(i.playerSize,2)||n.isArray(i.playerSize)&&i.playerSize.every((function(e){return n.isArrayOfNums(e,2)})))||i.sizeConfig),o=!!(i.adPodDurationSec&&n.isNumber(i.adPodDurationSec)&&i.adPodDurationSec>0),d=!!(i.durationRangeSec&&n.isArrayOfNums(i.durationRangeSec)&&i.durationRangeSec.every((function(e){return e>0})));if(!r||!o||!d)return a+=r?"":"\nmediaTypes.video.playerSize",a+=o?"":"\nmediaTypes.video.adPodDurationSec",a+=d?"":"\nmediaTypes.video.durationRangeSec",n.logWarn(a),!1}return!0}));t=i,e.call(this,t)}function j(e,t,i,a,r){if(r===s.a){var o=!0;if(u.b.getConfig("adpod.brandCategoryExclusion")&&!n.deepAccess(t,"meta.iabSubCatId")&&(o=!1),n.deepAccess(t,"video"))if(n.deepAccess(t,"video.context")&&t.video.context===s.a||(o=!1),!n.deepAccess(t,"video.durationSeconds")||t.video.durationSeconds<=0)o=!1;else(function(e,t){var i=n.deepAccess(t,"video.durationSeconds"),a=n.deepAccess(e,"mediaTypes.video"),r=a.durationRangeSec;if(r.sort((function(e,t){return e-t})),a.requireExactDuration){if(!p()(r,(function(e){return e===i})))return n.logWarn("Detected a bid with a duration value not part of the list of accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Exact match durations must be used for this adUnit. Rejecting bid: ",t),!1;t.video.durationBucket=i}else{var o=Math.max.apply(Math,T(r));if(!(i<=o+2))return n.logWarn("Detected a bid with a duration value outside the accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Rejecting bid: ",t),!1;var d=p()(r,(function(e){return e+2>=i}));t.video.durationBucket=d}return!0})(i,t)||(o=!1);u.b.getConfig("cache.url")||!t.vastXml||t.vastUrl||(n.logError('\n        This bid contains only vastXml and will not work when a prebid cache url is not specified.\n        Try enabling prebid cache with pbjs.setConfig({ cache: {url: "..."} });\n      '),o=!1),e.bail(o)}else e.call(this,t,i,a,r)}function O(e){void 0!==e.bidQueueTimeDelay&&("number"==typeof e.bidQueueTimeDelay&&e.bidQueueTimeDelay>0?_=e.bidQueueTimeDelay:n.logWarn("Detected invalid value for adpod.bidQueueTimeDelay in setConfig; must be a positive number.  Using default: ".concat(_))),void 0!==e.bidQueueSizeLimit&&("number"==typeof e.bidQueueSizeLimit&&e.bidQueueSizeLimit>0?A=e.bidQueueSizeLimit:n.logWarn("Detected invalid value for adpod.bidQueueSizeLimit in setConfig; must be a positive number.  Using default: ".concat(A)))}function B(e,t){Object(c.b)(e,(function(i,n){if(i)t(i,null);else{for(var a=[],r=0;r<n.length;r++)""!==n[r]&&a.push(e[r]);t(null,a)}}))}function U(e,t){return e.adserverTargeting[v.TARGETING_KEYS.PRICE_BUCKET]/e.video.durationBucket<t.adserverTargeting[v.TARGETING_KEYS.PRICE_BUCKET]/t.video.durationBucket?1:e.adserverTargeting[v.TARGETING_KEYS.PRICE_BUCKET]/e.video.durationBucket>t.adserverTargeting[v.TARGETING_KEYS.PRICE_BUCKET]/t.video.durationBucket?-1:0}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.codes,i=e.callback;if(i){var a=R(t=t||[]),r=b.a.getBidsReceived(),o=u.b.getConfig("adpod.brandCategoryExclusion"),d=u.b.getConfig("adpod.deferCaching"),c="boolean"!=typeof d||d,s=P(r,a);s=o||c?K(s):s;var f=u.b.getConfig("adpod.prioritizeDeals");if(f){var l=s.reduce((function(e,t){var i=n.deepAccess(t,"video.dealTier"),a=u.b.getConfig("adpod.dealTier.".concat(t.bidderCode,".minDealTier"));return a&&i?i>=a?e[1].push(t):e[0].push(t):i?e[1].push(t):e[0].push(t),e}),[[],[]]),g=m(l,2),p=g[0],v=g[1];v.sort(U),p.sort(U),s=v.concat(p)}else s.sort(U);var h={};if(!1===c)a.forEach((function(e){var t=[],i=n.deepAccess(e,"mediaTypes.video.adPodDurationSec");s.filter((function(t){return t.adUnitCode===e.code})).forEach((function(e,n,a){e.video.durationBucket<=i&&(t.push(y({},"hb_pb_cat_dur",e.adserverTargeting.hb_pb_cat_dur)),i-=e.video.durationBucket),n===a.length-1&&t.length>0&&t.push(y({},"hb_cache_id",e.adserverTargeting.hb_cache_id))})),h[e.code]=t})),i(null,h);else{var T=[];a.forEach((function(e){var t=n.deepAccess(e,"mediaTypes.video.adPodDurationSec");s.filter((function(t){return t.adUnitCode===e.code})).forEach((function(e){e.video.durationBucket<=t&&(T.push(e),t-=e.video.durationBucket)}))})),B(T,(function(e,t){if(e)i(e,null);else{var a=n.groupBy(t,"adUnitCode");Object.keys(a).forEach((function(e){var t=[];a[e].forEach((function(e,i,n){t.push(y({},"hb_pb_cat_dur",e.adserverTargeting.hb_pb_cat_dur)),i===n.length-1&&t.length>0&&t.push(y({},"hb_cache_id",e.adserverTargeting.hb_cache_id))})),h[e]=t})),i(null,h)}}))}return h}n.logError("No callback function was defined in the getTargeting call.  Aborting getTargeting().")}function R(e){return b.a.getAdUnits().filter((function(e){return n.deepAccess(e,"mediaTypes.video.context")===s.a})).filter((function(t){return!(e.length>0)||-1!=e.indexOf(t.code)}))}function K(e){var t=e.map((function(e){return h({},e,y({},"hb_pb_cat_dur",e.adserverTargeting.hb_pb_cat_dur))}));t=n.groupBy(t,"hb_pb_cat_dur");var i=[];return Object.keys(t).forEach((function(e){t[e].sort(n.compareOn("responseTimestamp")),i.push(t[e][0])})),i}function P(e,t){var i=t.map((function(e){return e.code}));return e.filter((function(e){return-1!=i.indexOf(e.adUnitCode)&&e.video&&e.video.context===s.a}))}u.b.getConfig("adpod",(function(e){return O(e.adpod)})),Object(d.d)(a.f,w),Object(d.d)(r.checkAdUnitSetup,D),Object(d.d)(o.c,j);var x={TARGETING_KEY_PB_CAT_DUR:"hb_pb_cat_dur",TARGETING_KEY_CACHE_ID:"hb_cache_id",getTargeting:k};Object.freeze(x),Object(d.c)("adpod",(function(){function e(e,t){for(var i in t)e[i]=t[i]}n.isPlainObject(arguments.length<=0?void 0:arguments[0])?e(arguments.length<=0?void 0:arguments[0],x):n.logError("Adpod module needs plain object to share methods with submodule")}))}}]);