(window.webpackJsonpreact_ads=window.webpackJsonpreact_ads||[]).push([[238],{218:function(e,i,n){"use strict";n.r(i),n.d(i,"internal",(function(){return f})),n.d(i,"sizeMappingInternalStore",(function(){return p})),n.d(i,"isUsingNewSizeMapping",(function(){return u})),n.d(i,"checkAdUnitSetupHook",(function(){return g})),n.d(i,"checkBidderSizeConfigFormat",(function(){return y})),n.d(i,"isLabelActivated",(function(){return v})),n.d(i,"getFilteredMediaTypes",(function(){return z})),n.d(i,"isSizeConfigActivated",(function(){return m})),n.d(i,"getActiveSizeBucket",(function(){return b})),n.d(i,"getRelevantMediaTypesForBidder",(function(){return h})),n.d(i,"getAdUnitDetail",(function(){return A})),n.d(i,"getBids",(function(){return T}));var t=n(277),r=n(298),a=n(334),o=n(283),d=n.n(o),s=n(291),c=n(357);function l(){return(l=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}var f={checkBidderSizeConfigFormat:y,getActiveSizeBucket:b,getFilteredMediaTypes:z,getAdUnitDetail:A,getRelevantMediaTypesForBidder:h,isLabelActivated:v},p=function(){var e={};return{initializeStore:function(i,n){e[i]={usingSizeMappingV2:n,adUnits:[]}},getAuctionDetail:function(i){return e[i]},setAuctionDetail:function(i,n){e[i].adUnits.push(n)}}}();function u(e){var i=!1;return e.forEach((function(e){e.mediaTypes&&(Object.keys(e.mediaTypes).forEach((function(n){e.mediaTypes[n].sizeConfig&&!1===i&&(i=!0)})),e.bids.forEach((function(e){e.sizeConfig&&!1===i&&(i=!0)})))})),i}function g(e){return e.filter((function(e){var i=e.mediaTypes;if(!i||0===Object.keys(i).length)return t.logError("Detected adUnit.code '".concat(e.code,"' did not have a 'mediaTypes' object defined. This is a required field for the auction, so this adUnit has been removed.")),!1;if(i.banner){var n=i.banner;if(n.sizes)c.adUnitSetupChecks.validateBannerMediaType(e);else if(n.sizeConfig)if(Array.isArray(n.sizeConfig)){var r=!1;n.sizeConfig.forEach((function(i,n){var a=Object.keys(i);if(!d()(a,"minViewPort")||!d()(a,"sizes"))return t.logError("Ad Unit: ".concat(e.code,": mediaTypes.banner.sizeConfig[").concat(n,"] is missing required property minViewPort or sizes or both.")),void(r=!0);var o=c.adUnitSetupChecks.validateSizes(i.sizes);t.isArrayOfNums(i.minViewPort,2)?i.sizes.length>0&&o.length>0?i.sizes=o:0===i.sizes.length?i.sizes=[i.sizes]:(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.banner.sizeConfig[").concat(n,"] has propery sizes declared with invalid value. Please ensure the sizes are listed like: [[300, 250], ...] or like: [] if no sizes are present for that size bucket.")),r=!0):(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.banner.sizeConfig[").concat(n,"] has property minViewPort decalared with invalid value. Please ensure minViewPort is an Array and is listed like: [700, 0]. Declaring an empty array is not allowed, instead use: [0, 0].")),r=!0)})),r&&(t.logInfo("Ad Unit: ".concat(e.code,": mediaTypes.banner has been removed due to error in sizeConfig.")),delete e.mediaTypes.banner)}else t.logError("Ad Unit: ".concat(e.code,": mediaTypes.banner.sizeConfig is NOT an Array. Removing the invalid object mediaTypes.banner from Ad Unit.")),delete e.mediaTypes.banner;else t.logError("Detected a mediaTypes.banner object did not include required property sizes or sizeConfig. Removing invalid mediaTypes.banner object from Ad Unit."),delete e.mediaTypes.banner}if(i.video){var a=i.video;if(a.playerSize)c.adUnitSetupChecks.validateVideoMediaType(e);else if(a.sizeConfig){if(!Array.isArray(a.sizeConfig))return t.logError("Ad Unit: ".concat(e.code,": mediaTypes.video.sizeConfig is NOT an Array. Removing the invalid property mediaTypes.video.sizeConfig from Ad Unit.")),delete e.mediaTypes.video.sizeConfig;var o=!1;a.sizeConfig.forEach((function(i,n){var r=Object.keys(i);if(!d()(r,"minViewPort")||!d()(r,"playerSize"))return t.logError("Ad Unit: ".concat(e.code,": mediaTypes.video.sizeConfig[").concat(n,"] is missing required property minViewPort or playerSize or both. Removing the invalid property mediaTypes.video.sizeConfig from Ad Unit.")),void(o=!0);var a="number"==typeof i.playerSize[0]?2:1,s=c.adUnitSetupChecks.validateSizes(i.playerSize,a);t.isArrayOfNums(i.minViewPort,2)?(2===a&&t.logInfo("Transforming video.playerSize from [640,480] to [[640,480]] so it's in the proper format."),i.playerSize.length>0&&s.length>0?i.playerSize=s:0===i.playerSize.length?i.playerSize=[i.playerSize]:(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.video.sizeConfig[").concat(n,"] has propery playerSize declared with invalid value. Please ensure the playerSize is listed like: [640, 480] or like: [] if no playerSize is present for that size bucket.")),o=!0)):(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.video.sizeConfig[").concat(n,"] has property minViewPort decalared with invalid value. Please ensure minViewPort is an Array and is listed like: [700, 0]. Declaring an empty array is not allowed, instead use: [0, 0].")),o=!0)})),o&&(t.logInfo("Ad Unit: ".concat(e.code,": mediaTypes.video.sizeConfig has been removed due to error in sizeConfig.")),delete e.mediaTypes.video.sizeConfig)}}if(i.native){var s=i.native;c.adUnitSetupChecks.validateNativeMediaType(e),i.native.sizeConfig&&s.sizeConfig.forEach((function(i){var n=Object.keys(i);return d()(n,"minViewPort")&&d()(n,"active")?t.isArrayOfNums(i.minViewPort,2)&&"boolean"==typeof i.active?void 0:(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.native.sizeConfig has properties minViewPort or active decalared with invalid values. Removing the invalid property mediaTypes.native.sizeConfig from Ad Unit.")),delete e.mediaTypes.native.sizeConfig):(t.logError("Ad Unit: ".concat(e.code,": mediaTypes.native.sizeConfig is missing required property minViewPort or active or both. Removing the invalid property mediaTypes.native.sizeConfig from Ad Unit.")),delete e.mediaTypes.native.sizeConfig)}))}return!0}))}function y(e){var i=!0;return Array.isArray(e)&&e.length>0?e.forEach((function(e){var n=Object.keys(e);i=!!(d()(n,"minViewPort")&&d()(n,"relevantMediaTypes")&&t.isArrayOfNums(e.minViewPort,2)&&Array.isArray(e.relevantMediaTypes)&&e.relevantMediaTypes.length>0&&(e.relevantMediaTypes.length>1?e.relevantMediaTypes.every((function(e){return d()(["banner","video","native"],e)})):["none","banner","video","native"].indexOf(e.relevantMediaTypes[0]>-1)))&&(i&&!0)})):i=!1,i}function v(e,i,n){var r,a=Object.keys(e).filter((function(e){return"labelAny"===e||"labelAll"===e}));return a&&a.length>1&&t.logWarn("SizeMappingV2:: ".concat(e.code?"Ad Unit: ".concat(e.code," has multiple label operators. Using the first declared operator: ").concat(a[0]):"Bidder: ".concat(e.bidder," in Ad Unit: ").concat(n," has multiple label operators. Using the first declared operator: ").concat(a[0]))),"labelAll"===(r=a[0])&&Array.isArray(e[r])?0===e.labelAll.length?(t.logWarn("SizeMappingV2:: Ad Unit: ".concat(e.code," has declared property labelAll with an empty array. Ad Unit is still enabled!")),!0):e.labelAll.every((function(e){return d()(i,e)})):"labelAny"!==r||!Array.isArray(e[r])||(0===e.labelAny.length?(t.logWarn("SizeMappingV2:: Ad Unit: ".concat(e.code," has declared property labelAny with an empty array. Ad Unit is still enabled!")),!0):e.labelAny.some((function(e){return d()(i,e)})))}function z(e){var i,n,r;r=t.deepClone(e);var a={banner:void 0,video:void 0,native:void 0};try{i=t.getWindowTop().innerWidth,n=t.getWindowTop().innerHeight}catch(e){t.logWarn("SizeMappingv2:: Unfriendly iframe blocks viewport size to be evaluated correctly"),i=window.innerWidth,n=window.innerHeight}var o=[i,n];Object.keys(e).map((function(i){var n=e[i].sizeConfig;if(n){a[i]=b(n,o);var t=n.filter((function(e){return e.minViewPort===a[i]&&m(i,e)}));r[i]=l({filteredSizeConfig:t},e[i]);var d={banner:"sizes",video:"playerSize"};r[i].filteredSizeConfig.length>0?"native"!==i&&(r[i][d[i]]=r[i].filteredSizeConfig[0][d[i]]):delete r[i]}}));var d=Object.keys(a).filter((function(e){return void 0!==a[e]})).reduce((function(e,i){return e[i]={activeSizeBucket:a[i],activeSizeDimensions:"banner"===i?r.banner?r.banner.sizes:[]:"video"===i?r.video?r.video.playerSize:[]:"NA"},e}),{});return{mediaTypes:e,sizeBucketToSizeMap:d,activeViewport:o,transformedMediaTypes:r}}function m(e,i){switch(e){case"banner":return i.sizes&&i.sizes.length>0&&i.sizes[0].length>0;case"video":return i.playerSize&&i.playerSize.length>0&&i.playerSize[0].length>0;case"native":return i.active;default:return!1}}function b(e,i){var n=[];return e.sort((function(e,i){return e.minViewPort[0]-i.minViewPort[0]})).forEach((function(e){i[0]>=e.minViewPort[0]&&(n=i[1]>=e.minViewPort[1]?e.minViewPort:[])})),n}function h(e,i){if(f.checkBidderSizeConfigFormat(e)){var n=f.getActiveSizeBucket(e,i);return e.filter((function(e){return e.minViewPort===n}))[0].relevantMediaTypes}return[]}function A(e,i){var n=p.getAuctionDetail(e).adUnits.filter((function(e){return e.adUnitCode===i.code}));if(n.length>0)return n[0];var r=f.getFilteredMediaTypes(i.mediaTypes),a=r.mediaTypes,o=r.sizeBucketToSizeMap,d=r.activeViewport,s=r.transformedMediaTypes,c={adUnitCode:i.code,mediaTypes:a,sizeBucketToSizeMap:o,activeViewport:d,transformedMediaTypes:s},l=Object.keys(a).filter((function(e){return-1===Object.keys(s).indexOf(e)}));return t.logInfo("SizeMappingV2:: AdUnit: ".concat(i.code," - Active size buckets after filtration: "),o),l.length>0&&t.logInfo("SizeMappingV2:: AdUnit: ".concat(i.code," - mediaTypes that got filtered out: ").concat(l)),p.setAuctionDetail(e,c),c}function T(e){var i=e.bidderCode,n=e.auctionId,o=e.bidderRequestId,d=e.adUnits,s=e.labels,c=e.src;return d.reduce((function(e,d){if(!f.isLabelActivated(d,s,d.code))return t.logInfo("SizeMappingV2:: Ad Unit: ".concat(d.code," is disabled due to failing label check.")),e;if(d.mediaTypes&&t.isValidMediaTypes(d.mediaTypes)){var p=f.getAdUnitDetail(n,d),u=p.activeViewport,g=p.transformedMediaTypes;if(0===Object.keys(g).length)return t.logInfo("SizeMappingV2:: Ad Unit: ".concat(d.code," is disabled since there are no active media types after sizeConfig filtration.")),e;e.push(d.bids.filter((function(e){return e.bidder===i})).reduce((function(e,p){if(f.isLabelActivated(p,s,d.code)){var y=d.nativeParams||t.deepAccess(d,"mediaTypes.native");if(y&&(p=l({},p,{nativeParams:Object(r.g)(y)})),(p=l({},p,t.getDefinedParams(d,["mediaType","renderer"]))).sizeConfig){var v=f.getRelevantMediaTypesForBidder(p.sizeConfig,u);if(0===v.length)t.logError("SizeMappingV2:: AdUnit: ".concat(d.code,", Bidder: ").concat(i," - sizeConfig is not configured properly. This bidder won't be eligible for sizeConfig checks and will remail active.")),p=l({},p);else{if("none"===v[0])return t.logInfo("SizeMappingV2:: AdUnit: ".concat(d.code,", Bidder: ").concat(p.bidder," - 'relevantMediaTypes' is set to 'none' in sizeConfig for current viewport size. This bidder is disabled.")),e;var z=Object.keys(g).filter((function(e){return v.indexOf(e)>-1})).reduce((function(e,i){return e[i]=g[i],e}),{});if(!(Object.keys(z).length>0))return t.logInfo("SizeMappingV2:: AdUnit: ".concat(d.code,", Bidder: ").concat(p.bidder," - 'relevantMediaTypes' for this bidder does not match with any of the active mediaTypes at the Ad Unit level. This bidder is disabled.")),e;p=l({},p,{mediaTypes:z})}}return e.push(l({},p,{adUnitCode:d.code,transactionId:d.transactionId,sizes:t.deepAccess(g,"banner.sizes")||t.deepAccess(g,"video.playerSize")||[],mediaTypes:p.mediaTypes||g,bidId:p.bid_id||t.getUniqueIdentifierStr(),bidderRequestId:o,auctionId:n,src:c,bidRequestsCount:a.a.getRequestsCounter(d.code),bidderRequestsCount:a.a.getBidderRequestsCounter(d.code,p.bidder),bidderWinsCount:a.a.getBidderWinsCounter(d.code,p.bidder)})),e}return t.logInfo("SizeMappingV2:: AdUnit: ".concat(d.code,", Bidder: ").concat(p.bidder," - Label check for this bidder has failed. This bidder is disabled.")),e}),[]))}else t.logWarn("SizeMappingV2:: Ad Unit: ".concat(d.code," has declared invalid mediaTypes or has not declared a mediaTypes property"));return e}),[]).reduce(t.flatten,[]).filter((function(e){return""!==e}))}Object(s.a)("checkAdUnitSetup").before((function(e,i){return u(i)?(i=g(i),e.bail(i)):e.call(this,i)})),Object(s.a)("getBids").before((function(e,i){if(void 0===p.getAuctionDetail(i.auctionId)){var n=u(i.adUnits);p.initializeStore(i.auctionId,n)}if(p.getAuctionDetail(i.auctionId).usingSizeMappingV2){var t=T(i);return e.bail(t)}return e.call(this,i)}))}}]);